# Зависимости проекта Figaro

## Обзор

Этот документ описывает все зависимости проекта и их совместимые версии.

## Критические зависимости

### Python
- **Версия**: 3.11
- **Причина**: Совместимость с sqlmodel==0.0.24 и pydantic==1.10.13
- **Альтернативы**: Python 3.10 (менее стабильно)

### Основные фреймворки
- **SQLAlchemy**: 2.0.31
- **SQLModel**: 0.0.24 (требует pydantic < 2.0)
- **Pydantic**: 1.10.13 (последняя версия 1.x)
- **FastAPI**: 0.104.1 (совместим с pydantic 1.x)

### База данных
- **psycopg2-binary**: 2.9.10 (PostgreSQL драйвер)
- **greenlet**: 3.2.3 (для асинхронной работы SQLAlchemy)

## Группы зависимостей

### Веб-фреймворк
```
fastapi==0.104.1
uvicorn==0.35.0
starlette==0.27.0
```

### База данных и ORM
```
SQLAlchemy==2.0.31
sqlmodel==0.0.24
psycopg2-binary==2.9.10
greenlet==3.2.3
```

### Аутентификация
```
passlib==1.7.4
python-jose==3.5.0
bcrypt==4.3.0
jose==1.0.0
```

### Обработка данных
```
numpy==1.26.2
pandas==2.1.3
DateTime==5.5
```

### HTTP и API
```
httpx==0.28.1
httpcore==1.0.9
h11==0.16.0
python-multipart==0.0.20
```

### Шаблоны
```
Jinja2==3.1.6
MarkupSafe==3.0.2
```

### Работа с файлами
```
openpyxl==3.1.5
et_xmlfile==2.0.0
```

### Тестирование
```
pytest==8.4.1
pluggy==1.6.0
iniconfig==2.1.0
```

## Известные проблемы и решения

### 1. Pydantic 2.x несовместимость
**Проблема**: SQLModel 0.0.24 не поддерживает Pydantic 2.x
**Решение**: Используем Pydantic 1.10.13

### 2. Python 3.12 несовместимость
**Проблема**: pydantic-core не собирается на Python 3.12
**Решение**: Используем Python 3.11

### 3. PyYAML проблемы сборки
**Проблема**: Старые версии PyYAML не собираются на новых Python
**Решение**: Убрали pydantic-settings, используем встроенный BaseSettings

## Обновление зависимостей

### Когда обновлять
- Исправления безопасности
- Критические баги
- Новая функциональность

### Как обновлять
1. Обновите версию в `requirements.txt`
2. Протестируйте локально
3. Пересоберите Docker-образ: `docker-compose build --no-cache`
4. Проверьте все функции

### Проверка совместимости
```bash
# Запустите скрипт проверки
python check_dependencies.py
```

## Файлы зависимостей

- `requirements.txt` - основной файл зависимостей
- `requirements-lock.txt` - зафиксированные версии (для документации)
- `check_dependencies.py` - скрипт проверки совместимости

## Docker

### Базовый образ
```dockerfile
FROM python:3.11-slim
```

### Установка зависимостей
```dockerfile
RUN pip install --upgrade pip && pip install -r /app/requirements.txt
```

## Мониторинг

### Проверка версий в контейнере
```bash
docker-compose exec app pip freeze
```

### Проверка совместимости
```bash
docker-compose exec app python check_dependencies.py
```

## Рекомендации

1. **Не обновляйте зависимости без тестирования**
2. **Используйте только зафиксированные версии**
3. **Проверяйте совместимость перед обновлением**
4. **Документируйте изменения в зависимостях**
5. **Тестируйте на чистой среде**

## Контакты

При проблемах с зависимостями:
1. Проверьте этот документ
2. Запустите `check_dependencies.py`
3. Проверьте логи Docker
4. Создайте issue с подробным описанием 