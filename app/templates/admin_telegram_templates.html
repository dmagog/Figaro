<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–∞–±–ª–æ–Ω—ã Telegram ‚Äî –ê–¥–º–∏–Ω–∫–∞ –§–∏–≥–∞—Ä–æ</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        body { background: #f6f7fb; font-family: 'Segoe UI', 'Arial', sans-serif; margin: 0; }
        .admin-container { max-width: 1400px; margin: 40px auto; padding: 30px; background: white; border-radius: 18px; box-shadow: 0 8px 32px rgba(60,60,120,0.08); }
        .admin-header { margin-bottom: 30px; display: flex; align-items: center; justify-content: space-between; gap: 24px; }
        .admin-nav-flex { display: flex; gap: 18px; flex-wrap: nowrap; align-items: center; position: relative; padding-bottom: 4px; overflow: hidden; }
        .admin-menu-btn { background: #667eea; color: white; padding: 10px 28px; border-radius: 10px; text-decoration: none; font-weight: 500; font-size: 1.08em; border: none; transition: background 0.18s, color 0.18s; display: inline-block; text-align: center; cursor: pointer; white-space: nowrap; }
        .admin-menu-btn:hover, .admin-menu-btn.active { background: #4f5bd5; color: #fff; }
        
        .templates-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        .templates-list { background: #f8f9fa; border-radius: 15px; padding: 25px; }
        .template-form { background: #f8f9fa; border-radius: 15px; padding: 25px; }
        
        .template-item { background: white; border: 1px solid #e1e5e9; border-radius: 10px; padding: 20px; margin-bottom: 15px; cursor: pointer; transition: all 0.2s; }
        .template-item:hover { border-color: #667eea; transform: translateY(-2px); }
        .template-item.selected { border-color: #667eea; background: #f0f4ff; }
        .template-item.inactive { opacity: 0.6; }
        
        .template-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .template-name { font-weight: 600; color: #333; font-size: 1.1em; }
        .template-status { font-size: 0.8em; padding: 4px 8px; border-radius: 4px; }
        .template-status.active { background: #d1fae5; color: #065f46; }
        .template-status.inactive { background: #fee2e2; color: #991b1b; }
        
        .template-content { color: #666; font-size: 0.9em; margin-bottom: 10px; max-height: 60px; overflow: hidden; }
        .template-variables { font-size: 0.8em; color: #999; }
        .template-actions { display: flex; gap: 10px; }
        .template-btn { padding: 6px 12px; border: none; border-radius: 6px; font-size: 0.8em; cursor: pointer; transition: background 0.2s; }
        .template-btn.edit { background: #667eea; color: white; }
        .template-btn.delete { background: #dc2626; color: white; }
        .template-btn:hover { opacity: 0.8; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 500; color: #4f5bd5; margin-bottom: 8px; font-size: 1.05em; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 1em; transition: border-color 0.2s; }
        .form-group input:focus, .form-group textarea:focus { border-color: #667eea; outline: none; }
        .form-group textarea { resize: vertical; min-height: 120px; }
        
        .form-actions { display: flex; gap: 15px; margin-top: 20px; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 1em; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .btn.primary { background: #667eea; color: white; }
        .btn.secondary { background: #e1e5e9; color: #333; }
        .btn.danger { background: #dc2626; color: white; }
        .btn:hover { transform: translateY(-1px); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        
        .variables-help { background: #f0f4ff; border: 1px solid #c7d2fe; border-radius: 8px; padding: 15px; margin-top: 15px; }
        .variables-help h4 { margin: 0 0 10px 0; color: #4f5bd5; }
        .variables-help ul { margin: 0; padding-left: 20px; }
        .variables-help li { margin-bottom: 5px; color: #666; }
        
        .status { margin-top: 15px; padding: 12px; border-radius: 8px; font-weight: 500; text-align: center; opacity: 0; transition: opacity 0.3s; }
        .status.visible { opacity: 1; }
        .status.success { background: #d1fae5; color: #065f46; }
        .status.error { background: #fee2e2; color: #991b1b; }
        
        .checkbox-group { display: flex; align-items: center; gap: 10px; }
        .checkbox-group input[type="checkbox"] { width: 18px; height: 18px; }
        
        @media (max-width: 1200px) { .templates-grid { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { .admin-container { padding: 15px; } .form-actions { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1 style="font-size:2.2em; margin:0; flex-shrink:0;">–®–∞–±–ª–æ–Ω—ã Telegram</h1>
            <nav class="admin-nav-flex">
                <a href="/admin" class="admin-menu-btn">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="/admin/telegram" class="admin-menu-btn">–†–∞—Å—Å—ã–ª–∫–∏</a>
                <a href="/admin/telegram/templates" class="admin-menu-btn active">–®–∞–±–ª–æ–Ω—ã</a>
                <a href="/" class="admin-menu-btn">üåê –ù–∞ —Å–∞–π—Ç</a>
            </nav>
        </div>

        <div class="templates-grid">
            <!-- –°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤ -->
            <div class="templates-list">
                <h3>üìù –°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤</h3>
                <div id="templates-container">
                    <!-- –®–∞–±–ª–æ–Ω—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>

            <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <div class="template-form">
                <h3 id="form-title">‚ûï –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω</h3>
                <form id="template-form">
                    <input type="hidden" id="template-id" name="id">
                    
                    <div class="form-group">
                        <label for="template-name">–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞:</label>
                        <input type="text" id="template-name" name="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞" required>
                    </div>

                    <div class="form-group">
                        <label for="template-content">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:</label>
                        <textarea id="template-content" name="content" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —à–∞–±–ª–æ–Ω–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="template-variables">–û–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (JSON):</label>
                        <textarea id="template-variables" name="variables" placeholder='{"name": "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", "email": "Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"}'></textarea>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="template-active" name="is_active" checked>
                            <label for="template-active" style="margin: 0;">–ê–∫—Ç–∏–≤–Ω—ã–π —à–∞–±–ª–æ–Ω</label>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn primary" id="save-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button type="button" class="btn secondary" id="cancel-btn">‚ùå –û—Ç–º–µ–Ω–∞</button>
                        <button type="button" class="btn danger" id="delete-btn" style="display: none;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </form>

                <div class="variables-help">
                    <h4>üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:</h4>
                    <ul>
                        <li><strong>{name}</strong> - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</li>
                        <li><strong>{email}</strong> - Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</li>
                        <li><strong>{telegram_username}</strong> - Username –≤ Telegram</li>
                        <li><strong>{tickets_count}</strong> - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤</li>
                        <li><strong>{total_spent}</strong> - –û–±—â–∞—è —Å—É–º–º–∞ –ø–æ–∫—É–ø–æ–∫</li>
                        <li><strong>{concerts_count}</strong> - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–µ—â—ë–Ω–Ω—ã—Ö –∫–æ–Ω—Ü–µ—Ä—Ç–æ–≤</li>
                        <li><strong>{user_id}</strong> - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</li>
                                                        <li><strong>{concert_name}</strong> - –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω—Ü–µ—Ä—Ç–∞</li>
                                <li><strong>{concert_id}</strong> - ID –∫–æ–Ω—Ü–µ—Ä—Ç–∞</li>
                                <li><strong>{concert_date}</strong> - –î–∞—Ç–∞ –∫–æ–Ω—Ü–µ—Ä—Ç–∞</li>
                                <li><strong>{hall_name}</strong> - –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–ª–∞</li>
                        <li><strong>{offer_text}</strong> - –¢–µ–∫—Å—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</li>
                        <li><strong>{expiry_date}</strong> - –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</li>
                        <li><strong>{route_concerts_count}</strong> - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ü–µ—Ä—Ç–æ–≤ –≤ –º–∞—Ä—à—Ä—É—Ç–µ</li>
                        <li><strong>{route_days}</strong> - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –º–∞—Ä—à—Ä—É—Ç–∞</li>
                        <li><strong>{route_halls}</strong> - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ª–æ–≤ –≤ –º–∞—Ä—à—Ä—É—Ç–µ</li>
                        <li><strong>{route_show_time}</strong> - –í—Ä–µ–º—è –∫–æ–Ω—Ü–µ—Ä—Ç–æ–≤ (–º–∏–Ω)</li>
                        <li><strong>{route_trans_time}</strong> - –í—Ä–µ–º—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (–º–∏–Ω)</li>
                        <li><strong>{route_wait_time}</strong> - –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è (–º–∏–Ω)</li>
                                                        <li><strong>{route_comfort_score}</strong> - –û—Ü–µ–Ω–∫–∞ –∫–æ–º—Ñ–æ—Ä—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞</li>
                                <li><strong>{route_intellect_score}</strong> - –û—Ü–µ–Ω–∫–∞ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞</li>
                                <li><strong>{route_genres}</strong> - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö –∂–∞–Ω—Ä–æ–≤</li>
                                <li><strong>{route_concerts_list}</strong> - –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ü–µ—Ä—Ç–æ–≤ –º–∞—Ä—à—Ä—É—Ç–∞</li>
                    </ul>
                </div>

                <div id="status" class="status"></div>
            </div>
        </div>
    </div>

    <script>
        let currentTemplate = null;
        let templates = [];

        // –ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤
        async function loadTemplates() {
            try {
                console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º —à–∞–±–ª–æ–Ω—ã...');
                const response = await fetch('/admin/telegram/templates');
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', data);
                
                if (data.success) {
                    templates = data.templates;
                    console.log('–®–∞–±–ª–æ–Ω—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', templates);
                    renderTemplates();
                } else {
                    console.error('–û—à–∏–±–∫–∞ API:', data.error);
                    showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤: ' + data.error, 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤:', error);
                showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤: ' + error.message, 'error');
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤
        function renderTemplates() {
            console.log('–†–µ–Ω–¥–µ—Ä–∏–º —à–∞–±–ª–æ–Ω—ã:', templates);
            const container = document.getElementById('templates-container');
            container.innerHTML = '';

            if (!templates || templates.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">–®–∞–±–ª–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                return;
            }

            templates.forEach((template, index) => {
                console.log(`–†–µ–Ω–¥–µ—Ä–∏–º —à–∞–±–ª–æ–Ω ${index}:`, template);
                const templateEl = document.createElement('div');
                templateEl.className = `template-item ${template.is_active ? '' : 'inactive'}`;
                templateEl.onclick = () => selectTemplate(template);
                
                templateEl.innerHTML = `
                    <div class="template-header">
                        <div class="template-name">${template.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</div>
                        <div class="template-status ${template.is_active ? 'active' : 'inactive'}">
                            ${template.is_active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                        </div>
                    </div>
                    <div class="template-content">${(template.content || '').substring(0, 100)}${(template.content || '').length > 100 ? '...' : ''}</div>
                    <div class="template-variables">${template.variables || '–ù–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö'}</div>
                    <div class="template-actions">
                        <button class="template-btn edit" onclick="editTemplate('${template.id}'); event.stopPropagation();" data-template-id="${template.id}">‚úèÔ∏è</button>
                        <button class="template-btn delete" onclick="deleteTemplate('${template.id}'); event.stopPropagation();" data-template-id="${template.id}">üóëÔ∏è</button>
                    </div>
                `;
                
                container.appendChild(templateEl);
            });
        }

        // –í—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞
        function selectTemplate(template) {
            console.log('–í—ã–±–∏—Ä–∞–µ–º —à–∞–±–ª–æ–Ω:', template);
            document.querySelectorAll('.template-item').forEach(el => el.classList.remove('selected'));
            
            // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç —à–∞–±–ª–æ–Ω–∞ –ø–æ ID
            const templateElement = document.querySelector(`[onclick*="editTemplate(${template.id})"]`).closest('.template-item');
            if (templateElement) {
                templateElement.classList.add('selected');
            }
            
            currentTemplate = template;
            console.log('–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω currentTemplate:', currentTemplate);
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
        function editTemplate(templateId) {
            console.log('–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —à–∞–±–ª–æ–Ω —Å ID:', templateId, '—Ç–∏–ø:', typeof templateId);
            console.log('–î–æ—Å—Ç—É–ø–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã:', templates);
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º ID –≤ —á–∏—Å–ª–æ, –µ—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞
            const numericId = parseInt(templateId);
            console.log('–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–π ID:', numericId);
            
            const template = templates.find(t => t.id === numericId);
            console.log('–ù–∞–π–¥–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω:', template);
            
            if (!template) {
                console.error('–®–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è ID:', templateId, '(—á–∏—Å–ª–æ–≤–æ–π ID:', numericId, ')');
                showStatus('–®–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }

            currentTemplate = template;
            console.log('–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º currentTemplate:', currentTemplate);
            
            document.getElementById('form-title').textContent = '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω';
            document.getElementById('template-id').value = template.id;
            document.getElementById('template-name').value = template.name || '';
            document.getElementById('template-content').value = template.content || '';
            document.getElementById('template-variables').value = template.variables || '';
            document.getElementById('template-active').checked = template.is_active;
            document.getElementById('delete-btn').style.display = 'inline-block';
            
            console.log('–§–æ—Ä–º–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ —à–∞–±–ª–æ–Ω–∞');
            console.log('is_active —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤:', template.is_active);
            console.log('–ß–µ–∫–±–æ–∫—Å checked:', document.getElementById('template-active').checked);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞
        function newTemplate() {
            currentTemplate = null;
            document.getElementById('form-title').textContent = '‚ûï –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω';
            document.getElementById('template-form').reset();
            document.getElementById('template-id').value = '';
            document.getElementById('delete-btn').style.display = 'none';
            document.querySelectorAll('.template-item').forEach(el => el.classList.remove('selected'));
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
        async function saveTemplate(formData) {
            const templateId = formData.get('id');
            const url = templateId ? `/admin/telegram/templates/${templateId}` : '/admin/telegram/templates';
            const method = templateId ? 'PUT' : 'POST';

            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã:');
            for (let [key, value] of formData.entries()) {
                console.log(`${key}: ${value}`);
            }

            try {
                const response = await fetch(url, {
                    method: method,
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showStatus(templateId ? '–®–∞–±–ª–æ–Ω –æ–±–Ω–æ–≤–ª—ë–Ω!' : '–®–∞–±–ª–æ–Ω —Å–æ–∑–¥–∞–Ω!', 'success');
                    await loadTemplates();
                    if (!templateId) {
                        newTemplate();
                    }
                } else {
                    showStatus('–û—à–∏–±–∫–∞: ' + data.error, 'error');
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
        async function deleteTemplate(templateId) {
            console.log('–£–¥–∞–ª—è–µ–º —à–∞–±–ª–æ–Ω —Å ID:', templateId, '—Ç–∏–ø:', typeof templateId);
            
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —à–∞–±–ª–æ–Ω?')) {
                return;
            }

            try {
                const response = await fetch(`/admin/telegram/templates/${templateId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showStatus('–®–∞–±–ª–æ–Ω –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!', 'success');
                    await loadTemplates();
                    if (currentTemplate && currentTemplate.id === templateId) {
                        newTemplate();
                    }
                } else {
                    showStatus('–û—à–∏–±–∫–∞: ' + data.error, 'error');
                }
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status visible ${type}`;
            
            setTimeout(() => {
                status.className = 'status';
            }, 3000);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('template-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            await saveTemplate(formData);
        });

        document.getElementById('cancel-btn').addEventListener('click', function() {
            newTemplate();
        });

        document.getElementById('delete-btn').addEventListener('click', function() {
            if (currentTemplate) {
                deleteTemplate(currentTemplate.id);
            }
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ù–æ–≤—ã–π —à–∞–±–ª–æ–Ω" –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫
        document.addEventListener('DOMContentLoaded', function() {
            const header = document.querySelector('.admin-header');
            const newBtn = document.createElement('button');
            newBtn.className = 'btn primary';
            newBtn.textContent = '‚ûï –ù–æ–≤—ã–π —à–∞–±–ª–æ–Ω';
            newBtn.onclick = newTemplate;
            header.appendChild(newBtn);
            
            loadTemplates();
        });
    </script>
</body>
</html> 