<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å—Å—ã–ª–∫–∞ Telegram ‚Äî –ê–¥–º–∏–Ω–∫–∞ –§–∏–≥–∞—Ä–æ</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        body { background: #f6f7fb; font-family: 'Segoe UI', 'Arial', sans-serif; margin: 0; }
        .admin-container { max-width: 1200px; margin: 40px auto; padding: 30px; background: white; border-radius: 18px; box-shadow: 0 8px 32px rgba(60,60,120,0.08); }
        .admin-header { margin-bottom: 30px; }
        .admin-nav-flex { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; position: relative; overflow-x: auto; padding-bottom: 4px; }
        .admin-menu-btn { background: #e0e7ff; color: #4f5bd5; padding: 10px 22px; border-radius: 10px; text-decoration: none; font-weight: 500; font-size: 1.08em; border: none; transition: background 0.18s, color 0.18s; display: inline-block; text-align: center; cursor: pointer; white-space: nowrap; }
        .admin-menu-btn:hover, .admin-menu-btn.active { background: #667eea; color: #fff; }
        .admin-section { margin: 0 auto; max-width: 600px; }
        .tg-form-card { background:#f8f9fa; border-radius:18px; padding:32px 32px 24px 32px; box-shadow:0 4px 24px rgba(102,126,234,0.13); animation: fadeIn 0.7s; }
        .tg-form-card label { font-weight:500; color:#4f5bd5; font-size:1.04em; }
        .tg-form-card input, .tg-form-card textarea { border:1.5px solid #d1d5db; border-radius:8px; padding:10px 14px; margin-top:6px; margin-bottom:16px; width:100%; font-size:1.08em; background:#fff; transition: border 0.18s; }
        .tg-form-card input:focus, .tg-form-card textarea:focus { border:1.5px solid #667eea; outline:none; }
        .tg-form-card button { background:#667eea; color:white; border:none; padding:13px 0; border-radius:8px; font-weight:600; cursor:pointer; margin-top:10px; width:100%; font-size:1.08em; box-shadow:0 2px 8px rgba(102,126,234,0.07); transition: background 0.18s; }
        .tg-form-card button:hover { background:#4f5bd5; }
        #tg-send-status { display:inline-block; margin-top:18px; font-weight:500; min-height:24px; opacity:0; transition:opacity 0.3s; }
        #tg-send-status.visible { opacity:1; }
        .tg-form-title { display:flex; align-items:center; gap:10px; font-size:1.35em; font-weight:600; color:#222; margin-bottom:18px; }
        .tg-form-title .tg-ico { font-size:1.3em; color:#229ed9; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(20px);} to { opacity:1; transform:translateY(0);} }
        @media (max-width: 700px) { .admin-container { padding: 10px; } .tg-form-card { padding: 16px 6px 12px 6px; } }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header" style="display: flex; align-items: center; justify-content: space-between; gap: 24px;">
            <h1 style="font-size:2.2em; margin:0; flex-shrink:0;">–ê–¥–º–∏–Ω–∫–∞ —Ñ–µ—Å—Ç–∏–≤–∞–ª—è</h1>
            <nav class="admin-nav-flex" id="adminNav" style="flex:1;">
                <a href="/admin" class="admin-menu-btn">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="/admin/users" class="admin-menu-btn">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
                <a href="/admin/customers" class="admin-menu-btn">–ü–æ–∫—É–ø–∞—Ç–µ–ª–∏</a>
                <a href="/admin/purchases" class="admin-menu-btn">–ü–æ–∫—É–ø–∫–∏</a>
                <a href="/admin/concerts" class="admin-menu-btn">–ö–æ–Ω—Ü–µ—Ä—Ç—ã</a>
                <a href="/admin/halls" class="admin-menu-btn">–ó–∞–ª—ã</a>
                <a href="/admin/routes" class="admin-menu-btn">–ú–∞—Ä—à—Ä—É—Ç—ã</a>
                <a href="/admin/offprogram" class="admin-menu-btn">–û—Ñ—Ñ-–ø—Ä–æ–≥—Ä–∞–º–º–∞</a>
                <a href="/admin/artists" class="admin-menu-btn">–ê—Ä—Ç–∏—Å—Ç—ã</a>
                <a href="/admin/authors" class="admin-menu-btn">–ê–≤—Ç–æ—Ä—ã</a>
                <a href="/admin/compositions" class="admin-menu-btn">–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è</a>
                <a href="/admin/genres" class="admin-menu-btn">–ñ–∞–Ω—Ä—ã</a>
                <a href="/admin/telegram" class="admin-menu-btn active">–†–∞—Å—Å—ã–ª–∫–∞ Telegram</a>
                <a href="/" class="admin-menu-btn"><span style="font-size:1.1em; margin-right:6px;">üåê</span>–ù–∞ —Å–∞–π—Ç</a>
            </nav>
        </div>
        <div class="admin-section">
            <a href="/admin/users" class="back-link" style="display:inline-block; margin-bottom:18px; color:#4f5bd5; text-decoration:underline;">‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</a>
            <div class="tg-form-title"><span class="tg-ico">&#128241;</span> –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram</div>
            <form id="tg-send-form" class="tg-form-card" enctype="multipart/form-data">
                <div style="margin-bottom:18px; display:flex; gap:14px; align-items:center; flex-wrap:wrap;">
                    <div style="flex:2; min-width:220px;">
                        <label for="tg-users">–í—ã–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</label>
                        <input type="text" id="tg-users-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è..." style="width:100%; margin-bottom:6px; border-radius:8px; border:1.5px solid #d1d5db; padding:7px 10px; font-size:1em;">
                        <select id="tg-users" name="user_ids" multiple size="6" style="width:100%; border-radius:8px; box-shadow:0 2px 8px rgba(102,126,234,0.07); border:1.5px solid #d1d5db; background:#fff; font-size:1.04em; padding:6px 0; transition:border 0.18s;">
                            <option disabled selected value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî</option>
                            {% for u in users %}
                                <option value="{{ u.id }}">[{{ u.id }}] {{ u.name or u.email }}{% if u.telegram_id %} (TG: {{ u.telegram_id }}){% endif %}</option>
                            {% endfor %}
                        </select>
                        <div style="font-size:0.93em; color:#888; margin-top:2px;">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ (Ctrl/Shift)</div>
                    </div>
                    <div style="flex:1; min-width:120px;">
                        <label for="tg-user-id">User ID:</label>
                        <input type="number" id="tg-user-id" name="user_id" placeholder="ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                    </div>
                    <span style="color:#888;">–∏–ª–∏</span>
                    <div style="flex:1; min-width:120px;">
                        <label for="tg-telegram-id">Telegram ID:</label>
                        <input type="number" id="tg-telegram-id" name="telegram_id" placeholder="ID –≤ Telegram">
                    </div>
                </div>
                <div style="margin-bottom:12px;">
                    <label for="tg-message">–°–æ–æ–±—â–µ–Ω–∏–µ:</label><br>
                    <textarea id="tg-message" name="message" rows="3" placeholder="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è..."></textarea>
                </div>
                <div style="margin-bottom:12px; display:flex; gap:18px; align-items:center; flex-wrap:wrap;">
                    <div style="flex:2; min-width:180px;">
                        <label for="tg-file">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª:</label>
                        <input type="file" id="tg-file" name="file" accept="image/*,application/pdf,.doc,.docx,.xls,.xlsx,.txt,.zip,.rar">
                        <div style="font-size:0.93em; color:#888; margin-top:2px;">–§–æ—Ç–æ –∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</div>
                    </div>
                    <div style="flex:1; min-width:120px; display:flex; align-items:center; gap:8px;">
                        <input type="checkbox" id="tg-markdown" name="markdown" style="width:18px; height:18px;" checked>
                        <label for="tg-markdown" style="margin:0; font-size:1em;">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Markdown</label>
                    </div>
                </div>
                <div style="font-size:0.93em; color:#888; margin-bottom:10px;">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è <a href="https://core.telegram.org/bots/api#markdown-style" target="_blank" style="color:#4f5bd5; text-decoration:underline;">Markdown</a>-—Ä–∞–∑–º–µ—Ç–∫–∞ Telegram</div>
                <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                <span id="tg-send-status"></span>
            </form>
        </div>
    </div>
    <script>
    // –§–∏–ª—å—Ç—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –ø–æ–∏—Å–∫—É
    document.getElementById('tg-users-search').addEventListener('input', function() {
      const search = this.value.toLowerCase();
      const select = document.getElementById('tg-users');
      Array.from(select.options).forEach(opt => {
        if (!opt.value) return; // placeholder
        const text = opt.textContent.toLowerCase();
        opt.style.display = text.includes(search) ? '' : 'none';
      });
    });
    document.getElementById('tg-send-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ user_ids
      const usersSelect = document.getElementById('tg-users');
      const selectedUserIds = Array.from(usersSelect.selectedOptions).map(opt => opt.value);
      formData.delete('user_ids');
      selectedUserIds.forEach(id => formData.append('user_ids', id));
      // –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
      const user_id = document.getElementById('tg-user-id').value;
      const telegram_id = document.getElementById('tg-telegram-id').value;
      if (user_id) formData.set('user_id', user_id);
      if (telegram_id) formData.set('telegram_id', telegram_id);
      const markdown = document.getElementById('tg-markdown').checked;
      formData.set('markdown', markdown ? '1' : '0');
      const status = document.getElementById('tg-send-status');
      status.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
      status.style.color = '#222';
      status.classList.add('visible');
      const resp = await fetch('/admin/send-telegram', {
        method: 'POST',
        body: formData
      });
      const data = await resp.json();
      if (data.success) {
        status.textContent = '‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!';
        status.style.color = '#10b981';
      } else {
        status.textContent = '‚ùå ' + (data.error || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
        status.style.color = '#dc2626';
      }
      status.classList.add('visible');
      setTimeout(() => status.classList.remove('visible'), 3500);
    });
    </script>
</body>
</html> 