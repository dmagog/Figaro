<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –§–µ—Å—Ç–∏–≤–∞–ª—å –§–∏–≥–∞—Ä–æ</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        body {
            background: #f6f7fb;
            font-family: 'Segoe UI', 'Arial', sans-serif;
            margin: 0;
        }
        .admin-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 30px;
            background: white;
            border-radius: 18px;
            box-shadow: 0 8px 32px rgba(60,60,120,0.08);
        }
        .admin-header {
            margin-bottom: 30px;
        }
        .admin-nav-flex {
            display: flex;
            gap: 18px;
            flex-wrap: nowrap;
            align-items: center;
            position: relative;
            overflow-x: auto;
            padding-bottom: 4px;
        }
        .admin-menu-btn {
            background: #667eea;
            color: white;
            padding: 10px 28px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 500;
            font-size: 1.08em;
            border: none;
            transition: background 0.18s, color 0.18s;
            display: inline-block;
            text-align: center;
            cursor: pointer;
            white-space: nowrap;
        }
        .admin-menu-btn:hover, .admin-menu-btn.active {
            background: #4f5bd5;
            color: #fff;
        }
        /* –£–¥–∞–ª–µ–Ω—ã —Å—Ç–∏–ª–∏ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é, —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—â–∏–π style.css */
        .admin-menu-dropdown-arrow {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 24px;
            height: 12px;
            pointer-events: none;
            z-index: 1003;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px);}
            to { opacity: 1; transform: translateY(0);}
        }
        .admin-summary {
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–æ–≤ */
        .admin-section {
            margin-bottom: 40px;
        }
        .admin-section-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e7ff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .admin-section-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .summary-card {
            background: linear-gradient(135deg, #e0e7ff 0%, #f0f4ff 100%);
            border-radius: 12px;
            padding: 14px 10px;
            box-shadow: 0 2px 8px rgba(102,126,234,0.07);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 110px;
        }
        .summary-card h3 {
            margin: 0 0 8px 0;
            font-size: 1.18em;
            color: #667eea;
            font-weight: 600;
        }
        .summary-card p {
            margin: 0;
            font-size: 2.1em;
            font-weight: bold;
            color: #222;
        }
        .profile-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            background: #f4f6fb;
            border-radius: 14px;
            box-shadow: 0 2px 8px rgba(60,60,120,0.06);
            padding: 10px 6px 8px 6px;
            min-width: 140px;
            min-height: 110px;
        }
        .profile-avatar {
            font-size: 1.3em;
            background: #e0e7ff;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2px;
        }
        .profile-info {
            text-align: center;
        }
        .profile-name {
            font-weight: 600;
            color: #4f5bd5;
            font-size: 1em;
        }
        .profile-role {
            font-size: 0.9em;
            color: #8ca0c7;
            margin-bottom: 2px;
        }
        .profile-link {
            margin-top: 6px;
            color: #4f5bd5;
            text-decoration: underline;
            font-weight: 500;
            transition: color 0.18s;
        }
        .profile-link:hover {
            color: #1e88e5;
        }
        .profile-card:hover {
            background: rgba(255,193,7,0.22);
            box-shadow: 0 2px 12px rgba(255,193,7,0.13);
            text-decoration: none;
        }
        .summary-card:not(.profile-card):hover {
            background: #e0e7ff;
            box-shadow: 0 2px 12px rgba(76, 110, 245, 0.10);
            text-decoration: none;
        }
        @media (max-width: 900px) {
            .admin-nav-flex { gap: 8px; }
            .admin-menu-btn, .admin-menu-dropdown-btn { padding: 10px 12px; font-size: 1em; }
            .admin-menu-dropdown-content { min-width: 120px; }
            .admin-summary { 
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); 
                gap: 16px; 
            }
        }
    </style>
</head>
<body>

    <div class="admin-container">
        {% block content %}
        <div class="admin-header" style="display: flex; align-items: center; justify-content: space-between; gap: 24px;">
            <h1 style="font-size:2.2em; margin:0; flex-shrink:0;">–ê–¥–º–∏–Ω–∫–∞ —Ñ–µ—Å—Ç–∏–≤–∞–ª—è</h1>
            <nav class="admin-nav-flex" id="adminNav" style="flex:1;">
                <a href="/admin" class="admin-menu-btn">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="/admin/users" class="admin-menu-btn">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
                <a href="/admin/customers" class="admin-menu-btn">–ü–æ–∫—É–ø–∞—Ç–µ–ª–∏</a>
                <a href="/admin/purchases" class="admin-menu-btn">–ü–æ–∫—É–ø–∫–∏</a>
                <a href="/admin/concerts" class="admin-menu-btn">–ö–æ–Ω—Ü–µ—Ä—Ç—ã</a>
                <a href="/admin/halls" class="admin-menu-btn">–ó–∞–ª—ã</a>
                <a href="/admin/routes" class="admin-menu-btn">–ú–∞—Ä—à—Ä—É—Ç—ã</a>
                <a href="/admin/offprogram" class="admin-menu-btn">–û—Ñ—Ñ-–ø—Ä–æ–≥—Ä–∞–º–º–∞</a>
                <a href="/admin/artists" class="admin-menu-btn">–ê—Ä—Ç–∏—Å—Ç—ã</a>
                <a href="/admin/authors" class="admin-menu-btn">–ê–≤—Ç–æ—Ä—ã</a>
                <a href="/admin/compositions" class="admin-menu-btn">–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è</a>
                <a href="/admin/genres" class="admin-menu-btn">–ñ–∞–Ω—Ä—ã</a>
                <a href="/admin/telegram" class="admin-menu-btn">–†–∞—Å—Å—ã–ª–∫–∞ Telegram</a>
                <a href="/" class="admin-menu-btn"><span style="font-size:1.1em; margin-right:6px;">ÔøΩÔøΩ</span>–ù–∞ —Å–∞–π—Ç</a>
                <div class="admin-menu-dropdown" id="adminMenuDropdown" style="display:none;">
                    <button class="admin-menu-dropdown-btn" id="dropdownBtn">–ï—â—ë <span style="font-size:1.1em;">‚ñº</span></button>
                    <div class="admin-menu-dropdown-content" id="dropdownContent">
                        <div class="admin-menu-dropdown-arrow">
                            <svg width="24" height="12"><polygon points="12,12 0,0 24,0" fill="#f0f4ff"/></svg>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
        <div>
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.name or user.email }}!</h2>
            <p>–≠—Ç–æ –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–¥–º–∏–Ω–∫–∏. –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–¥–µ–ª–∞–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.</p>
        </div>
        
        <!-- üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∞—É–¥–∏—Ç–æ—Ä–∏—è -->
        <div class="admin-section">
            <div class="admin-section-title">
                <span style="font-size: 1.3em;">üë•</span>
                –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∞—É–¥–∏—Ç–æ—Ä–∏—è
            </div>
            <div class="admin-section-grid">
                <a href="/admin/users" style="text-decoration:none; color:inherit;" title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º">
                    <div class="summary-card" style="cursor:pointer;">
                        <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                        <p>{{ summary.users_count }}</p>
                    </div>
                </a>
                <a href="/admin/customers" style="text-decoration:none; color:inherit;" title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º">
                    <div class="summary-card" style="cursor:pointer;">
                        <h3>–ü–æ–∫—É–ø–∞—Ç–µ–ª–µ–π</h3>
                        <p>{{ summary.customers_count or 0 }}</p>
                    </div>
                </a>
                <a href="/admin/purchases" style="text-decoration:none; color:inherit;" title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫—É–ø–æ–∫">
                    <div class="summary-card">
                        <h3>–ë–∏–ª–µ—Ç–æ–≤ –∫—É–ø–ª–µ–Ω–æ</h3>
                        <p>{{ summary.tickets_count }}</p>
                    </div>
                </a>
            </div>
        </div>
        
        <!-- üéµ –ö–æ–Ω—Ç–µ–Ω—Ç —Ñ–µ—Å—Ç–∏–≤–∞–ª—è -->
        <div class="admin-section">
            <div class="admin-section-title">
                <span style="font-size: 1.3em;">üéµ</span>
                –ö–æ–Ω—Ç–µ–Ω—Ç —Ñ–µ—Å—Ç–∏–≤–∞–ª—è
            </div>
            <div class="admin-section-grid">
                <a href="/admin/concerts" style="text-decoration:none; color:inherit;" title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–æ–Ω—Ü–µ—Ä—Ç–∞–º">
                    <div class="summary-card" style="cursor:pointer;">
                        <h3>–ö–æ–Ω—Ü–µ—Ä—Ç–æ–≤</h3>
                        <p>{{ summary.concerts_count }}</p>
                    </div>
                </a>
                <a href="/admin/halls" style="text-decoration:none; color:inherit;" title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–ª–∞–º">
                    <div class="summary-card" style="cursor:pointer;">
                        <h3>–ó–∞–ª–æ–≤</h3>
                        <p>{{ summary.halls_count }}</p>
                    </div>
                </a>
                <a href="/admin/artists" style="text-decoration:none; color:inherit;" title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –∞—Ä—Ç–∏—Å—Ç–∞–º">
                    <div class="summary-card" style="cursor:pointer;">
                        <h3>–ê—Ä—Ç–∏—Å—Ç–æ–≤</h3>
                        <p>{{ summary.artists_count or 0 }}</p>
                    </div>
                </a>
                <a href="/admin/authors" style="text-decoration:none; color:inherit;" title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –∞–≤—Ç–æ—Ä–∞–º">
                    <div class="summary-card" style="cursor:pointer;">
                        <h3>–ê–≤—Ç–æ—Ä–æ–≤</h3>
                        <p>{{ summary.authors_count or 0 }}</p>
                    </div>
                </a>
                <a href="/admin/compositions" style="text-decoration:none; color:inherit;" title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è–º">
                    <div class="summary-card" style="cursor:pointer;">
                        <h3>–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π</h3>
                        <p>{{ summary.compositions_count or 0 }}</p>
                    </div>
                </a>
                <a href="/admin/genres" style="text-decoration:none; color:inherit;" title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –∂–∞–Ω—Ä–∞–º">
                    <div class="summary-card" style="cursor:pointer;">
                        <h3>–ñ–∞–Ω—Ä–æ–≤</h3>
                        <p>{{ summary.genres_count or 0 }}</p>
                    </div>
                </a>
            </div>
        </div>
        
        <!-- üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="admin-section">
            <div class="admin-section-title">
                <span style="font-size: 1.3em;">üìä</span>
                –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            </div>
            <div class="admin-section-grid">
                <div class="summary-card">
                    <h3>–°—É–º–º–∞ –ø–æ–∫—É–ø–æ–∫</h3>
                    <p>{{ "{: }".format(summary.total_spent) }} ‚ÇΩ</p>
                </div>
                <div class="summary-card">
                    <h3>–°—Ä–µ–¥–Ω—è—è –∑–∞–ø–æ–ª–Ω—è–µ–º–æ—Å—Ç—å</h3>
                    <p>{{ '%.2f' % summary.avg_fill }}</p>
                </div>
                <a href="/admin/routes/view" style="text-decoration:none; color:inherit;" title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –º–∞—Ä—à—Ä—É—Ç–∞–º">
                    <div class="summary-card" style="cursor:pointer;">
                        <h3>–ú–∞—Ä—à—Ä—É—Ç–æ–≤</h3>
                        <p>{{ routes_count }}</p>
                    </div>
                </a>
            </div>
        </div>
        
        <!-- üé™ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ -->
        <div class="admin-section">
            <div class="admin-section-title">
                <span style="font-size: 1.3em;">üé™</span>
                –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
            </div>
            <div class="admin-section-grid">
                <a href="/admin/offprogram" style="text-decoration:none; color:inherit;" title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ—Ñ-–ø—Ä–æ–≥—Ä–∞–º–º–µ">
                    <div class="summary-card" style="cursor:pointer;">
                        <h3>–û—Ñ—Ñ-–ø—Ä–æ–≥—Ä–∞–º–º–∞</h3>
                        <p>{{ summary.off_program_count or 0 }}</p>
                    </div>
                </a>
            </div>
        </div>
        
        <!-- üë§ –ü—Ä–æ—Ñ–∏–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
        <div class="admin-section">
            <div class="admin-section-title">
                <span style="font-size: 1.3em;">üë§</span>
                –ü—Ä–æ—Ñ–∏–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            </div>
            <div class="admin-section-grid">
                <a href="/profile" style="text-decoration:none; color:inherit;" title="–ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å">
                    <div class="summary-card profile-card" style="cursor:pointer; transition:box-shadow 0.18s, background 0.18s;">
                        <div class="profile-avatar">üëë </div>
                        <div class="profile-info">
                            <div class="profile-name">{{ user.name or user.email }}</div>
                            <div class="profile-role">–°—É–ø–µ—Ä–∞–¥–º–∏–Ω</div>
                        </div>
                    </div>
                </a>
            </div>
        </div>
        {% endblock %}
    </div>
    <script>
    // –ë—É—Ä–≥–µ—Ä-–º–µ–Ω—é –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('open');
    }
    document.addEventListener('DOMContentLoaded', function() {
        const burger = document.getElementById('burger');
        const sidebar = document.getElementById('sidebar');
        function checkMobile() {
            if (window.innerWidth <= 600) {
                burger.style.display = 'flex';
                sidebar.classList.remove('open');
            } else {
                burger.style.display = 'none';
                sidebar.classList.remove('open');
            }
        }
        burger.addEventListener('click', toggleSidebar);
        window.addEventListener('resize', checkMobile);
        checkMobile();
    });
    // –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é –¥–ª—è –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è
    document.addEventListener('DOMContentLoaded', function() {
        const nav = document.getElementById('adminNav');
        const dropdown = document.getElementById('adminMenuDropdown');
        const dropdownBtn = document.getElementById('dropdownBtn');
        const dropdownContent = document.getElementById('dropdownContent');
        function updateDropdown() {
            // –°–±—Ä–æ—Å
            dropdownContent.innerHTML = '<div class="admin-menu-dropdown-arrow">\n<svg width="24" height="12"><polygon points="12,12 0,0 24,0" fill="#f0f4ff"/></svg>\n</div>';
            let linksWrapper = document.createElement('div');
            linksWrapper.className = 'admin-menu-dropdown-links';
            let navWidth = nav.offsetWidth;
            let total = 0;
            let overflowed = [];
            const children = Array.from(nav.children).filter(el => el.classList.contains('admin-menu-btn'));
            children.forEach(el => {
                el.style.display = '';
            });
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–∞–∫–∏–µ –∫–Ω–æ–ø–∫–∏ –Ω–µ –ø–æ–º–µ—â–∞—é—Ç—Å—è
            children.forEach(el => {
                const rect = el.getBoundingClientRect();
                const navRect = nav.getBoundingClientRect();
                if (rect.right > navRect.right - 120) { // 120px –∑–∞–ø–∞—Å –ø–æ–¥ dropdown
                    overflowed.push(el);
                }
            });
            if (overflowed.length > 0) {
                overflowed.forEach(el => {
                    let clone = el.cloneNode(true);
                    clone.classList.remove('admin-menu-btn');
                    if (clone.getAttribute('href') === '/') {
                        clone.innerHTML = '<span style="font-size:1.1em; margin-right:6px;">üåê</span>–ù–∞ —Å–∞–π—Ç';
                    } else {
                        clone.innerHTML = clone.textContent.trim();
                    }
                    linksWrapper.appendChild(clone);
                    el.style.display = 'none';
                });
                dropdownContent.appendChild(linksWrapper);
                dropdown.style.display = 'inline-block';
            } else {
                dropdown.style.display = 'none';
            }
        }
        window.addEventListener('resize', updateDropdown);
        updateDropdown();
        // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ dropdown
        dropdownBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            dropdown.classList.toggle('open');
            if (dropdown.classList.contains('open')) {
                const btnRect = dropdownBtn.getBoundingClientRect();
                dropdownContent.style.left = btnRect.left + 'px';
                dropdownContent.style.top = (btnRect.bottom + 6) + 'px';
            }
        });
        document.body.addEventListener('click', function() {
            dropdown.classList.remove('open');
        });
    });
    </script>
</body>
</html> 