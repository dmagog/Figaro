{% extends "admin_routes_main.html" %}
{% block routes_content %}

<style>
.routes-header {
    margin-bottom: 12px;
}

.routes-header-content {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 8px;
}

.routes-title {
    font-size: 1.2em;
    color: #4f5bd5;
    margin-bottom: 6px;
    font-weight: 600;
}

.routes-description {
    color: #666;
    margin: 0;
    font-size: 0.9em;
    line-height: 1.4;
}



.routes-table-container {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(60,60,120,0.04);
    overflow: hidden;
    margin-bottom: 16px;
}

.routes-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9em;
}

.routes-table th {
    background: #f8f9ff;
    color: #4f5bd5;
    font-weight: 600;
    padding: 12px 16px;
    text-align: left;
    border-bottom: 2px solid #e0e7ff;
    font-size: 0.85em;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.routes-table td {
    padding: 12px 16px;
    border-bottom: 1px solid #f0f0f0;
    color: #3a3a4a;
}

.routes-table tr:hover {
    background: #f8f9ff;
}

.route-id {
    font-weight: 600;
    color: #4f5bd5;
    font-family: 'Courier New', monospace;
}

.route-composition {
    font-weight: 500;
    color: #43A047;
}

.route-time {
    font-family: 'Courier New', monospace;
    color: #666;
}

.route-costs {
    font-weight: 600;
    color: #e53935;
}

.route-score {
    font-weight: 500;
    color: #4f5bd5;
}

.route-level {
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 0.8em;
    font-weight: 500;
    text-align: center;
}

.route-level-high {
    background: #e8f5e8;
    color: #43A047;
}

.route-level-medium {
    background: #fff3e0;
    color: #ff9800;
}

.route-level-low {
    background: #ffebee;
    color: #e53935;
}

.route-last-check {
    font-size: 0.8em;
    color: #999;
    font-style: italic;
}

.no-routes {
    text-align: center;
    padding: 40px;
    color: #666;
}

.no-routes-icon {
    font-size: 2em;
    margin-bottom: 16px;
    opacity: 0.5;
}

.pagination {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    margin-top: 16px;
}

.pagination-info {
    font-size: 0.9em;
    color: #666;
}

.pagination-controls {
    display: flex;
    gap: 8px;
    align-items: center;
}

.pagination-dots {
    padding: 8px 12px;
    color: #666;
}

.pagination-btn {
    padding: 8px 12px;
    border: 1px solid #e0e7ff;
    background: #fff;
    color: #4f5bd5;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9em;
}

.pagination-btn:hover {
    background: #f8f9ff;
}

.pagination-btn.active {
    background: #4f5bd5;
    color: #fff;
    border-color: #4f5bd5;
}

.pagination-btn:disabled {
    background: #f5f5f5;
    color: #ccc;
    cursor: not-allowed;
    border-color: #f0f0f0;
}


</style>

<div class="routes-header">
    <div class="routes-header-content">
        <div>
            <h2 class="routes-title">–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã —Ñ–µ—Å—Ç–∏–≤–∞–ª—è</h2>
            <p class="routes-description">–¢–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –±–∏–ª–µ—Ç–æ–≤ –∫–æ–Ω—Ü–µ—Ä—Ç–æ–≤.</p>
        </div>
    </div>
</div>

{% if routes_count and routes_count > 0 %}
    {% if routes_data and routes_data|length > 0 %}
<div class="routes-table-container">
    <table class="routes-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>–°–æ—Å—Ç–∞–≤</th>
                <th>–î–Ω–∏</th>
                <th>–ö–æ–Ω—Ü–µ—Ä—Ç—ã</th>
                <th>–ó–∞–ª—ã</th>
                <th>–ñ–∞–Ω—Ä</th>
                <th>–í—Ä–µ–º—è –ø–æ–∫–∞–∑–∞</th>
                <th>–ü–µ—Ä–µ—Ö–æ–¥—ã</th>
                <th>–û–∂–∏–¥–∞–Ω–∏–µ</th>
                <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                <th>–ö–æ–º—Ñ–æ—Ä—Ç</th>
                <th>–£—Ä–æ–≤–µ–Ω—å</th>
                <th>–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</th>
                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                <th>–ü—Ä–æ–≤–µ—Ä–∫–∞</th>
            </tr>
        </thead>
        <tbody>
            {% for route in routes_data %}
            <tr>
                <td class="route-id">{{ route.id }}</td>
                <td class="route-composition">{{ route.composition }}</td>
                <td>{{ route.days }}</td>
                <td>{{ route.concerts }}</td>
                <td>{{ route.halls }}</td>
                <td>{{ route.genre }}</td>
                <td class="route-time">{{ route.show_time }}</td>
                <td class="route-time">{{ route.trans_time }}</td>
                <td class="route-time">{{ route.wait_time }}</td>
                <td class="route-costs">{{ route.costs }}</td>
                <td class="route-score">{{ route.comfort_score }}</td>
                <td>
                    {% if route.comfort_level == 'High' %}
                        <span class="route-level route-level-high">–í—ã—Å–æ–∫–∏–π</span>
                    {% elif route.comfort_level == 'Medium' %}
                        <span class="route-level route-level-medium">–°—Ä–µ–¥–Ω–∏–π</span>
                    {% elif route.comfort_level == 'Low' %}
                        <span class="route-level route-level-low">–ù–∏–∑–∫–∏–π</span>
                    {% else %}
                        <span class="route-level">{{ route.comfort_level }}</span>
                    {% endif %}
                </td>
                <td class="route-score">{{ route.intellect_score }}</td>
                <td>{{ route.intellect_category }}</td>
                <td class="route-last-check">{{ route.last_check }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if pagination and pagination.total_pages > 1 %}
<div class="pagination">
    <div class="pagination-info">
        –ü–æ–∫–∞–∑–∞–Ω–æ {{ pagination.start_item }}-{{ pagination.end_item }} –∏–∑ {{ pagination.total_count }} –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
    </div>
    <div class="pagination-controls">
        <button class="pagination-btn" onclick="changePage({{ pagination.current_page - 1 }})" 
                {% if pagination.current_page <= 1 %}disabled{% endif %}>
            ‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è
        </button>
        
        {% set start_page = [1, pagination.current_page - 2] | max %}
        {% set end_page = [pagination.total_pages, pagination.current_page + 2] | min %}
        
        {% if start_page > 1 %}
            <button class="pagination-btn" onclick="changePage(1)">1</button>
            {% if start_page > 2 %}
                <span class="pagination-dots">...</span>
            {% endif %}
        {% endif %}
        
        {% for page_num in range(start_page, end_page + 1) %}
            <button class="pagination-btn {% if page_num == pagination.current_page %}active{% endif %}" 
                    onclick="changePage({{ page_num }})">
                {{ page_num }}
            </button>
        {% endfor %}
        
        {% if end_page < pagination.total_pages %}
            {% if end_page < pagination.total_pages - 1 %}
                <span class="pagination-dots">...</span>
            {% endif %}
            <button class="pagination-btn" onclick="changePage({{ pagination.total_pages }})">
                {{ pagination.total_pages }}
            </button>
        {% endif %}
        
        <button class="pagination-btn" onclick="changePage({{ pagination.current_page + 1 }})" 
                {% if pagination.current_page >= pagination.total_pages %}disabled{% endif %}>
            –°–ª–µ–¥—É—é—â–∞—è ‚Üí
        </button>
    </div>
</div>
{% endif %}

    {% else %}
    <div class="no-routes">
        <div class="no-routes-icon">üó∫Ô∏è</div>
        <div style="font-size: 1.2em; margin-bottom: 8px;">–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
        <div style="color: #999; margin-bottom: 16px;">
            –í–æ–∑–º–æ–∂–Ω–æ, –≤—Å–µ –∫–æ–Ω—Ü–µ—Ä—Ç—ã –≤ –º–∞—Ä—à—Ä—É—Ç–∞—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –∏–ª–∏ –º–∞—Ä—à—Ä—É—Ç—ã –Ω–µ –±—ã–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.
        </div>
        <div style="font-size: 0.9em; color: #666;">
            <a href="/admin/routes/upload" style="color: #4f5bd5; text-decoration: none;">–ó–∞–≥—Ä—É–∑–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã</a> | 
            <a href="/admin/routes/concerts" style="color: #4f5bd5; text-decoration: none;">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ü–µ—Ä—Ç–æ–≤</a>
        </div>
    </div>
    {% endif %}
{% else %}
<div class="no-routes">
    <div class="no-routes-icon">üó∫Ô∏è</div>
    <div style="font-size: 1.2em; margin-bottom: 8px; color: #e53935;">–ú–∞—Ä—à—Ä—É—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</div>
    <div style="color: #999; margin-bottom: 16px;">
        –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —Å –º–∞—Ä—à—Ä—É—Ç–∞–º–∏.
    </div>
    <div style="font-size: 0.9em; color: #666;">
        <a href="/admin/routes/upload" style="color: #4f5bd5; text-decoration: none;">–ó–∞–≥—Ä—É–∑–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã</a>
    </div>
</div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    const table = document.querySelector('.routes-table');
    if (table) {
        // –î–æ–±–∞–≤–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∏
        const headers = table.querySelectorAll('th');
        headers.forEach((header, index) => {
            header.style.cursor = 'pointer';
            header.addEventListener('click', function() {
                sortTable(index);
            });
        });
    }
    
    function sortTable(columnIndex) {
        const table = document.querySelector('.routes-table');
        const tbody = table.querySelector('tbody');
        const rows = Array.from(tbody.querySelectorAll('tr'));
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–ª–æ–Ω–∫–µ
        const sampleValue = rows[0].cells[columnIndex].textContent.trim();
        const isNumeric = !isNaN(parseFloat(sampleValue)) && isFinite(sampleValue);
        
        rows.sort((a, b) => {
            const aValue = a.cells[columnIndex].textContent.trim();
            const bValue = b.cells[columnIndex].textContent.trim();
            
            if (isNumeric) {
                return parseFloat(aValue) - parseFloat(bValue);
            } else {
                return aValue.localeCompare(bValue, 'ru');
            }
        });
        
        // –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
        rows.forEach(row => tbody.appendChild(row));
    }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–º–µ–Ω—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
function changePage(page) {
    if (page < 1) return;
    
    const currentUrl = new URL(window.location);
    currentUrl.searchParams.set('page', page);
    window.location.href = currentUrl.toString();
}
</script>

{% endblock %} 